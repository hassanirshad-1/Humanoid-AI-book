"use strict";(globalThis.webpackChunkfrontend=globalThis.webpackChunkfrontend||[]).push([[445],{5125:(s,e,a)=>{a.r(e),a.d(e,{assets:()=>o,contentTitle:()=>h,default:()=>x,frontMatter:()=>c,metadata:()=>n,toc:()=>m});const n=JSON.parse('{"id":"chapter-02-reward-signal/2.2-first-reward","title":"Lesson 2.2: Your First Reward: Implementing a Survival Bonus","description":"In this lesson, you will move from theory to practice by implementing your very first reward function for a humanoid robot in a MuJoCo simulation. You will learn how to define a simple \\"survival bonus\\" that encourages the robot to stay upright, integrate this reward into a simulation loop, and understand the practical challenges of translating such a reward from simulation to a real robot.","source":"@site/docs/chapter-02-reward-signal/2.2-first-reward.mdx","sourceDirName":"chapter-02-reward-signal","slug":"/chapter-02-reward-signal/2.2-first-reward","permalink":"/Humanoid-AI-book/chapter-02-reward-signal/2.2-first-reward","draft":false,"unlisted":false,"editUrl":"https://github.com/hassanirshad-1/Humanoid-AI-book/tree/main/docs/chapter-02-reward-signal/2.2-first-reward.mdx","tags":[],"version":"current","frontMatter":{"title":"Lesson 2.2: Your First Reward: Implementing a Survival Bonus","sidebar_label":"2.2 Your First Reward"},"sidebar":"tutorialSidebar","previous":{"title":"2.1 What is a Reward","permalink":"/Humanoid-AI-book/chapter-02-reward-signal/2.1-what-is-a-reward"},"next":{"title":"2.3 Reward Shaping","permalink":"/Humanoid-AI-book/chapter-02-reward-signal/2.3-reward-shaping"}}');var i=a(4848),t=a(8453),l=a(8149);const r='# Copyright 2025 The AI-Native Textbook Authors.\r\n#\r\n# Licensed under the Apache License, Version 2.0 (the "License");\r\n# you may not use this file except in compliance with the License.\r\n# You may obtain a copy of the License at\r\n#\r\n#     http://www.apache.org/licenses/LICENSE-2.0\r\n#\r\n# Unless required by applicable law or agreed to in writing, software\r\n# distributed under the License is distributed on an "AS IS" BASIS,\r\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n# See the License for the specific language governing permissions and\r\n# limitations under the License.\r\n\r\n"""\r\nThis script contains the first reward function for our humanoid robot.\r\nThe goal is a simple "survival" bonus: reward the robot for not falling.\r\n"""\r\n\r\ndef is_fallen(d):\r\n  """\r\n  Checks if the robot has fallen based on its torso orientation and height.\r\n\r\n  Args:\r\n    d: MuJoCo data structure.\r\n\r\n  Returns:\r\n    A boolean indicating if the robot has fallen.\r\n  """\r\n  # The Z-axis of the torso\'s rotation matrix. 1.0 is perfectly upright.\r\n  torso_z_axis = d.xmat[\'torso\', \'zz\']\r\n  # The Z-height of the torso\'s center of mass.\r\n  torso_z_height = d.qpos[2]\r\n\r\n  # We consider the robot "fallen" if its torso is too tilted or too low.\r\n  return torso_z_axis < 0.8 or torso_z_height < 0.3\r\n\r\ndef calculate_reward(d):\r\n  """\r\n  Calculates the reward for the current timestep.\r\n\r\n  Args:\r\n    d: MuJoCo data structure.\r\n\r\n  Returns:\r\n    A scalar reward value.\r\n  """\r\n  # A simple survival reward: +1 for being upright, 0 for being fallen.\r\n  if is_fallen(d):\r\n    return 0.0\r\n  else:\r\n    return 1.0\r\n',c={title:"Lesson 2.2: Your First Reward: Implementing a Survival Bonus",sidebar_label:"2.2 Your First Reward"},h="Lesson 2.2: Your First Reward: Implementing a Survival Bonus",o={},m=[{value:"The Concrete Hook: The First Rule of Robotics - Don&#39;t Fall Down",id:"the-concrete-hook-the-first-rule-of-robotics---dont-fall-down",level:2},{value:"The Intuition: The Perpetual &quot;Stay Upright&quot; Game",id:"the-intuition-the-perpetual-stay-upright-game",level:2},{value:"Defining &quot;Fallen&quot; for a Robot",id:"defining-fallen-for-a-robot",level:3},{value:"The Formalism: A Threshold-Based Instantaneous Reward",id:"the-formalism-a-threshold-based-instantaneous-reward",level:2},{value:"The Code: Implementing <code>calculate_reward</code>",id:"the-code-implementing-calculate_reward",level:2},{value:"Breaking Down the Code",id:"breaking-down-the-code",level:3},{value:"Integrating into the Simulation Loop",id:"integrating-into-the-simulation-loop",level:3},{value:"The Simulation: Observing Survival",id:"the-simulation-observing-survival",level:2},{value:"The Reality Check (Sim-to-Real): Sensor Noise and IMU Drift",id:"the-reality-check-sim-to-real-sensor-noise-and-imu-drift",level:2},{value:"Knowledge Check \u2713",id:"knowledge-check-",level:2},{value:"Try This",id:"try-this",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(s){const e={annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",mstyle:"mstyle",msub:"msub",mtable:"mtable",mtd:"mtd",mtext:"mtext",mtr:"mtr",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...s.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"lesson-22-your-first-reward-implementing-a-survival-bonus",children:"Lesson 2.2: Your First Reward: Implementing a Survival Bonus"})}),"\n",(0,i.jsx)(e.p,{children:'In this lesson, you will move from theory to practice by implementing your very first reward function for a humanoid robot in a MuJoCo simulation. You will learn how to define a simple "survival bonus" that encourages the robot to stay upright, integrate this reward into a simulation loop, and understand the practical challenges of translating such a reward from simulation to a real robot.'}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"the-concrete-hook-the-first-rule-of-robotics---dont-fall-down",children:"The Concrete Hook: The First Rule of Robotics - Don't Fall Down"}),"\n",(0,i.jsxs)(e.p,{children:["For any bipedal or quadrupedal robot, the most fundamental skill is maintaining balance. A robot that constantly falls cannot perform any useful tasks. Whether it's a disaster-relief robot navigating rubble or a service robot carrying objects, staying upright is paramount. Our first reward function will directly address this most basic necessity: incentivizing the robot to ",(0,i.jsx)(e.strong,{children:"not fall over"}),"."]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.img,{src:"https://www.industrialrobotics.com/wp-content/uploads/2021/04/robot-falling.jpg",alt:"Fallen robot vs upright robot"}),"\r\n",(0,i.jsx)(e.em,{children:"Figure 2.2.1: A robot struggling with balance (left) versus one maintaining stability (right). Our first reward aims to encourage the latter."})]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"the-intuition-the-perpetual-stay-upright-game",children:'The Intuition: The Perpetual "Stay Upright" Game'}),"\n",(0,i.jsx)(e.p,{children:'Imagine a toddler learning to walk. Every moment they stand or take a step without falling, they experience a natural "reward" \u2013 perhaps the joy of mobility or the praise of a parent. The moment they fall, the "reward" is a bump and a temporary halt to their progress. Over time, the toddler learns to associate certain muscle movements and balance adjustments with staying upright, eventually mastering walking.'}),"\n",(0,i.jsx)(e.p,{children:"For our robot, we'll create a similar, albeit simpler, game. At every step of the simulation, the robot will receive a small positive numerical reward for remaining upright. If it falls, this positive reward stops (or a penalty is issued). The robot, through trial and error, will learn to prioritize actions that keep it from falling, thus maximizing its cumulative survival bonus. This constant, immediate feedback makes \"staying upright\" the robot's primary, implicit goal."}),"\n",(0,i.jsx)(e.h3,{id:"defining-fallen-for-a-robot",children:'Defining "Fallen" for a Robot'}),"\n",(0,i.jsx)(e.p,{children:'How do we quantitatively define "fallen" for a robot in a simulation? We need measurable criteria from the robot\'s state. Two key indicators are:'}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Torso Orientation"}),": How much is the robot's main body (torso) tilted from the vertical axis? If it's too horizontal, it's likely fallen."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Torso Height"}),": Is the robot's center of mass (specifically its torso) too close to the ground? A very low torso height suggests it's no longer standing."]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:'By combining these two checks, we create a robust definition of what it means for our simulated robot to be "fallen."'}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"the-formalism-a-threshold-based-instantaneous-reward",children:"The Formalism: A Threshold-Based Instantaneous Reward"}),"\n",(0,i.jsxs)(e.p,{children:["Our survival bonus can be formalized as an instantaneous reward function ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"r"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"r(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]})," that depends only on the current state ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"s_t"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]}),". The function evaluates to a constant positive value if the robot is upright, and zero (or a negative penalty) otherwise."]}),"\n",(0,i.jsxs)(e.p,{children:["Let ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"U"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"U(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]})," be a boolean predicate that is true if the robot is upright in state ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"s_t"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.5806em",verticalAlign:"-0.15em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]})]})})]})," and false if it has fallen. Our reward function ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"r"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"r(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]})," can be defined as:"]}),"\n",(0,i.jsx)(e.span,{className:"katex-display",children:(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"r"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{fence:"true",children:"{"}),(0,i.jsxs)(e.mtable,{rowspacing:"0.36em",columnalign:"left left",columnspacing:"1em",children:[(0,i.jsxs)(e.mtr,{children:[(0,i.jsx)(e.mtd,{children:(0,i.jsx)(e.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mo,{children:"+"}),(0,i.jsx)(e.mi,{children:"C"})]})})}),(0,i.jsx)(e.mtd,{children:(0,i.jsx)(e.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mtext,{children:"if\xa0"}),(0,i.jsx)(e.mi,{children:"U"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mtext,{children:"\xa0is\xa0true\xa0(robot\xa0is\xa0upright)"})]})})})]}),(0,i.jsxs)(e.mtr,{children:[(0,i.jsx)(e.mtd,{children:(0,i.jsx)(e.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mn,{children:"0"}),(0,i.jsx)(e.mtext,{children:"\xa0or\xa0"}),(0,i.jsx)(e.mo,{children:"\u2212"}),(0,i.jsx)(e.mi,{children:"P"})]})})}),(0,i.jsx)(e.mtd,{children:(0,i.jsx)(e.mstyle,{scriptlevel:"0",displaystyle:"false",children:(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mtext,{children:"if\xa0"}),(0,i.jsx)(e.mi,{children:"U"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mtext,{children:"\xa0is\xa0false\xa0(robot\xa0has\xa0fallen)"})]})})})]})]})]})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"r(s_t) = \\begin{cases}\n+C & \\text{if } U(s_t) \\text{ is true (robot is upright)} \\\\ \n0 \\text{ or } -P & \\text{if } U(s_t) \\text{ is false (robot has fallen)}\n\\end{cases}"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"3em",verticalAlign:"-1.25em"}}),(0,i.jsxs)(e.span,{className:"minner",children:[(0,i.jsx)(e.span,{className:"mopen delimcenter",style:{top:"0em"},children:(0,i.jsx)(e.span,{className:"delimsizing size4",children:"{"})}),(0,i.jsx)(e.span,{className:"mord",children:(0,i.jsxs)(e.span,{className:"mtable",children:[(0,i.jsx)(e.span,{className:"col-align-l",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.69em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3.69em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.008em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"+"}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"})]})]}),(0,i.jsxs)(e.span,{style:{top:"-2.25em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.008em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord",children:"0"}),(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"\xa0or\xa0"})}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2212"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"})]})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"1.19em"},children:(0,i.jsx)(e.span,{})})})]})}),(0,i.jsx)(e.span,{className:"arraycolsep",style:{width:"1em"}}),(0,i.jsx)(e.span,{className:"col-align-l",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsxs)(e.span,{className:"vlist",style:{height:"1.69em"},children:[(0,i.jsxs)(e.span,{style:{top:"-3.69em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.008em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"if\xa0"})}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"\xa0is\xa0true\xa0(robot\xa0is\xa0upright)"})})]})]}),(0,i.jsxs)(e.span,{style:{top:"-2.25em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"3.008em"}}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"if\xa0"})}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mord text",children:(0,i.jsx)(e.span,{className:"mord",children:"\xa0is\xa0false\xa0(robot\xa0has\xa0fallen)"})})]})]})]}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"1.19em"},children:(0,i.jsx)(e.span,{})})})]})})]})}),(0,i.jsx)(e.span,{className:"mclose nulldelimiter"})]})]})]})]})}),"\n",(0,i.jsx)(e.p,{children:"Where:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"C"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"C"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6833em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"})]})})]})," is a positive constant (e.g., 1.0) representing the survival bonus."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"P"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"P"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.6833em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.13889em"},children:"P"})]})})]})," is a positive constant representing a penalty, if we choose to include one. For simplicity, we often use 0 when fallen, implying no further reward can be gained."]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["The predicate ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"U"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"U(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]})," itself can be broken down into two conditions:"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Orientation Check"}),": The ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"z"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"z"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.04398em"},children:"z"})]})})]}),"-axis component of the torso's orientation matrix (which indicates alignment with the global up-vector) is above a certain threshold (e.g., 0.8). Let this be ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"O"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"O(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"O"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]}),"."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Height Check"}),": The ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"z"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"z"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.04398em"},children:"z"})]})})]}),"-coordinate of the torso's center of mass is above a certain minimum height (e.g., 0.3 meters). Let this be ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"H"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"H(s_t)"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.08125em"},children:"H"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})})]}),"."]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["Thus, ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsxs)(e.mrow,{children:[(0,i.jsx)(e.mi,{children:"U"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"="}),(0,i.jsx)(e.mi,{children:"O"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"}),(0,i.jsx)(e.mo,{children:"\u2227"}),(0,i.jsx)(e.mi,{children:"H"}),(0,i.jsx)(e.mo,{stretchy:"false",children:"("}),(0,i.jsxs)(e.msub,{children:[(0,i.jsx)(e.mi,{children:"s"}),(0,i.jsx)(e.mi,{children:"t"})]}),(0,i.jsx)(e.mo,{stretchy:"false",children:")"})]}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"U(s_t) = O(s_t) \\land H(s_t)"})]})})}),(0,i.jsxs)(e.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.10903em"},children:"U"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(e.span,{className:"mrel",children:"="}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"O"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(e.span,{className:"mbin",children:"\u2227"}),(0,i.jsx)(e.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.08125em"},children:"H"}),(0,i.jsx)(e.span,{className:"mopen",children:"("}),(0,i.jsxs)(e.span,{className:"mord",children:[(0,i.jsx)(e.span,{className:"mord mathnormal",children:"s"}),(0,i.jsx)(e.span,{className:"msupsub",children:(0,i.jsxs)(e.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(e.span,{className:"vlist-r",children:[(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.2806em"},children:(0,i.jsxs)(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(e.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(e.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(e.span,{className:"mord mathnormal mtight",children:"t"})})]})}),(0,i.jsx)(e.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(e.span,{className:"vlist-r",children:(0,i.jsx)(e.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(e.span,{})})})]})})]}),(0,i.jsx)(e.span,{className:"mclose",children:")"})]})]})]}),", meaning the robot is upright only if ",(0,i.jsx)(e.em,{children:"both"})," its orientation is sufficiently vertical ",(0,i.jsx)(e.em,{children:"and"})," its height is above a minimum threshold."]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsxs)(e.h2,{id:"the-code-implementing-calculate_reward",children:["The Code: Implementing ",(0,i.jsx)(e.code,{children:"calculate_reward"})]}),"\n",(0,i.jsxs)(e.p,{children:["We will now implement this logic in Python. The code below defines an ",(0,i.jsx)(e.code,{children:"is_fallen"})," helper function and our main ",(0,i.jsx)(e.code,{children:"calculate_reward"})," function, which you can integrate into your MuJoCo simulation loop from Chapter 1."]}),"\n",(0,i.jsx)(l.A,{language:"python",title:"lesson_2_2_survival_reward.py",children:r}),"\n",(0,i.jsx)(e.h3,{id:"breaking-down-the-code",children:"Breaking Down the Code"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:(0,i.jsx)(e.code,{children:"is_fallen(d)"})}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["This helper function assesses the robot's upright status using the MuJoCo data structure ",(0,i.jsx)(e.code,{children:"d"}),"."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"d.xmat['torso', 'zz']"})," provides the ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"z"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"z"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.04398em"},children:"z"})]})})]}),"-component of the torso's ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"z"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"z"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.04398em"},children:"z"})]})})]}),"-axis in world coordinates. A value of ",(0,i.jsx)(e.code,{children:"1.0"})," signifies perfect vertical alignment, ",(0,i.jsx)(e.code,{children:"0.0"})," means horizontal, and ",(0,i.jsx)(e.code,{children:"-1.0"})," is inverted. We check if this value is below ",(0,i.jsx)(e.code,{children:"0.8"}),", indicating a significant tilt."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"d.qpos[2]"})," gives the ",(0,i.jsxs)(e.span,{className:"katex",children:[(0,i.jsx)(e.span,{className:"katex-mathml",children:(0,i.jsx)(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,i.jsxs)(e.semantics,{children:[(0,i.jsx)(e.mrow,{children:(0,i.jsx)(e.mi,{children:"z"})}),(0,i.jsx)(e.annotation,{encoding:"application/x-tex",children:"z"})]})})}),(0,i.jsx)(e.span,{className:"katex-html","aria-hidden":"true",children:(0,i.jsxs)(e.span,{className:"base",children:[(0,i.jsx)(e.span,{className:"strut",style:{height:"0.4306em"}}),(0,i.jsx)(e.span,{className:"mord mathnormal",style:{marginRight:"0.04398em"},children:"z"})]})})]}),"-coordinate of the torso's center of mass. We check if this is below ",(0,i.jsx)(e.code,{children:"0.3"})," meters, suggesting the robot is too low to be considered standing."]}),"\n",(0,i.jsxs)(e.li,{children:['The robot is deemed "fallen" if ',(0,i.jsx)(e.em,{children:"either"})," its tilt exceeds the limit ",(0,i.jsx)(e.em,{children:"or"})," its height drops too low. This logical OR (",(0,i.jsx)(e.code,{children:"or"}),") ensures that if one critical condition is met, the robot is considered fallen."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:(0,i.jsx)(e.code,{children:"calculate_reward(d)"})}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"This is our core reward function."}),"\n",(0,i.jsxs)(e.li,{children:["It calls ",(0,i.jsx)(e.code,{children:"is_fallen(d)"}),". If ",(0,i.jsx)(e.code,{children:"True"}),", the reward is ",(0,i.jsx)(e.code,{children:"0.0"})," (no survival bonus)."]}),"\n",(0,i.jsxs)(e.li,{children:["If ",(0,i.jsx)(e.code,{children:"is_fallen(d)"})," is ",(0,i.jsx)(e.code,{children:"False"})," (robot is upright), the reward is ",(0,i.jsx)(e.code,{children:"1.0"})," (our positive survival bonus)."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"integrating-into-the-simulation-loop",children:"Integrating into the Simulation Loop"}),"\n",(0,i.jsxs)(e.p,{children:["To use this reward function, you would call it at each simulation step and accumulate the rewards. Here's how it fits into a typical MuJoCo ",(0,i.jsx)(e.code,{children:"mj_step"})," loop:"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'import mujoco\r\nimport mujoco.viewer\r\nimport numpy as np\r\nimport time\r\n\r\n# Load the model (e.g., your robot model from Chapter 1)\r\n# m = mujoco.MjModel.from_xml_path("path/to/your/robot.xml")\r\n# d = mujoco.MjData(m)\r\n\r\n# Initialize cumulative reward\r\ncumulative_reward = 0.0\r\n# Define the maximum simulation time to prevent infinite loops for demonstration\r\nmax_sim_time = 10.0 # seconds\r\ndt = m.opt.timestep # simulation timestep\r\n\r\nwith mujoco.viewer.launch_passive(m, d) as viewer:\r\n    # Reset the simulation if needed\r\n    mujoco.mj_reset_data(m, d)\r\n\r\n    while viewer.is_running() and d.time < max_sim_time:\r\n        # Generate some random controls (replace with your policy in future lessons)\r\n        # Here, we use random controls to quickly demonstrate falling\r\n        mujoco.mj_step(m, d) # Step the simulation forward\r\n\r\n        # Calculate the reward for the current state\r\n        reward = calculate_reward(d)\r\n        cumulative_reward += reward\r\n\r\n        # Print the current state and reward\r\n        viewer.sync() # Update the viewer\r\n        time.sleep(dt) # Pause for visualization if desired\r\n\r\n        if is_fallen(d):\r\n            print(f"Robot has fallen at time {d.time:.2f}s. Cumulative Reward: {cumulative_reward:.2f}")\r\n            break # Stop simulation if fallen\r\n\r\n    print(f"Simulation ended. Total Cumulative Reward: {cumulative_reward:.2f}")\r\n    if d.time >= max_sim_time:\r\n        print("Max simulation time reached.")\r\n\n'})}),"\n",(0,i.jsx)(e.p,{children:(0,i.jsxs)(e.em,{children:["Code 2.2.2: Conceptual integration of the ",(0,i.jsx)(e.code,{children:"calculate_reward"})," function into a MuJoCo simulation loop. Note: ",(0,i.jsx)(e.code,{children:"m"})," and ",(0,i.jsx)(e.code,{children:"d"})," should be loaded from your robot XML."]})}),"\n",(0,i.jsx)(e.p,{children:"When you run a simulation with this reward and, for instance, a random action policy (as in Chapter 1), you'll quickly observe the robot falling. The cumulative reward will increase only for the few steps the robot manages to stay upright, then it will cease to accumulate. This demonstrates that a naive policy without learning will struggle to maximize this simple survival reward."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"the-simulation-observing-survival",children:"The Simulation: Observing Survival"}),"\n",(0,i.jsx)(e.p,{children:"After implementing this, you can run your MuJoCo simulation. You should observe:"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Initial Reward Accumulation"}),": For the first few steps, as the robot struggles to balance (if using a random policy), the cumulative reward will increase (e.g., 1.0, 2.0, 3.0...)."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Falling and Reward Stoppage"}),": As soon as the robot's torso tilts too far or its height drops below the threshold defined in ",(0,i.jsx)(e.code,{children:"is_fallen"}),", the reward per step will drop to ",(0,i.jsx)(e.code,{children:"0.0"}),". Consequently, the cumulative reward will stop increasing."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Visual Confirmation"}),": You will visually see the robot collapse in the viewer, confirming that the ",(0,i.jsx)(e.code,{children:"is_fallen"})," condition has been met."]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:"This immediate visual feedback in the simulation reinforces the connection between the robot's physical state, our defined conditions, and the resulting reward signal."}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"the-reality-check-sim-to-real-sensor-noise-and-imu-drift",children:"The Reality Check (Sim-to-Real): Sensor Noise and IMU Drift"}),"\n",(0,i.jsxs)(e.p,{children:["In our MuJoCo simulation, the robot's state information, such as torso orientation (",(0,i.jsx)(e.code,{children:"d.xmat"}),") and height (",(0,i.jsx)(e.code,{children:"d.qpos[2]"}),"), is perfectly accurate and noise-free. In the real world, this data comes from physical sensors, primarily an ",(0,i.jsx)(e.strong,{children:"Inertial Measurement Unit (IMU)"})," for orientation and sometimes ",(0,i.jsx)(e.strong,{children:"kinematic sensors"})," (like encoders on joints) for position."]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsxs)(e.th,{style:{textAlign:"left"},children:["Simulation Data (MuJoCo ",(0,i.jsx)(e.code,{children:"d"}),")"]}),(0,i.jsx)(e.th,{style:{textAlign:"left"},children:"Real-World Sensor Data Challenges"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:["Perfect rotation matrix for torso (",(0,i.jsx)(e.code,{children:"d.xmat"}),")"]}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"IMU Noise and Drift"}),': Raw IMU data is noisy and accumulates integration errors over time, leading to "drift" in orientation estimates. Complex sensor fusion (e.g., Kalman filters, complementary filters) is needed.']})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:["Exact joint positions/velocities (",(0,i.jsx)(e.code,{children:"d.qpos"}),", ",(0,i.jsx)(e.code,{children:"d.qvel"}),")"]}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"Encoder Noise"}),": Encoders can have quantization noise or slip."]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"Precise contact information"}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"Contact Uncertainty"}),": Hard to detect precise contact points and forces, especially on soft surfaces."]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"Instantaneous, lag-free data"}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"Sensor Latency"}),": There's always a delay between a physical event and its measurement being available."]})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{style:{textAlign:"left"},children:"Idealized physics model"}),(0,i.jsxs)(e.td,{style:{textAlign:"left"},children:[(0,i.jsx)(e.strong,{children:"Unmodeled Dynamics"}),": Factors like friction, elasticity, and mechanical backlash are never perfectly modeled, impacting how the robot behaves and thus how ",(0,i.jsx)(e.code,{children:"is_fallen"})," might be triggered."]})]})]})]}),"\n",(0,i.jsxs)(e.p,{children:["A reward function like ",(0,i.jsx)(e.code,{children:"is_fallen"}),' must be made robust to these real-world imperfections. For instance, using a simple threshold on raw IMU data could lead to false positives (robot is fine, but sensor noise triggers "fallen") or false negatives (robot is actually fallen, but sensor drift makes it appear upright). Techniques like filtering sensor data, using more sophisticated state estimators, or making reward thresholds more lenient are crucial for sim-to-real transfer.']}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"knowledge-check-",children:"Knowledge Check \u2713"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Question 1"}),': What is the primary incentive provided by the "survival bonus" reward function implemented in this lesson?\r\na) To make the robot walk faster.\r\nb) To encourage the robot to interact with objects.\r\nc) To keep the robot from falling over.\r\nd) To help the robot navigate complex environments.']}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Question 2"}),": In the ",(0,i.jsx)(e.code,{children:"is_fallen"})," function, why is it considered more robust to check ",(0,i.jsx)(e.em,{children:"both"})," the torso's orientation and its height, rather than just one of these conditions?\r\na) Because checking both is computationally cheaper.\r\nb) Because it prevents false positives or negatives, capturing a truer sense of \"fallen.\"\r\nc) Because MuJoCo requires both parameters for accurate simulation.\r\nd) Because it allows for more fine-grained control over the robot's movements."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"Question 3"}),": Describe at least two specific challenges introduced by real-world sensors (like IMUs) that are not present in a perfect simulation when evaluating the ",(0,i.jsx)(e.code,{children:"is_fallen"})," condition."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"try-this",children:"Try This"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsxs)(e.strong,{children:["Modify the ",(0,i.jsx)(e.code,{children:"is_fallen"})," Thresholds"]}),":"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Experiment"}),": Change the ",(0,i.jsx)(e.code,{children:"0.8"})," threshold for torso orientation (e.g., to ",(0,i.jsx)(e.code,{children:"0.95"})," for stricter uprightness, or ",(0,i.jsx)(e.code,{children:"0.5"})," for more leniency) and the ",(0,i.jsx)(e.code,{children:"0.3"})," meter height threshold (e.g., to ",(0,i.jsx)(e.code,{children:"0.5"})," or ",(0,i.jsx)(e.code,{children:"0.1"}),")."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Observe"}),': Run the simulation with a random policy after each change. How does the cumulative reward change? Does the robot appear to "fall" at different points visually compared to when the reward function declares it fallen?']}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Reflect"}),": What are the implications of very strict versus very lenient thresholds on a robot's learning process? How might this affect a learning agent's behavior if it were trying to maximize this reward?"]}),"\n"]}),"\n",(0,i.jsx)(e.hr,{}),"\n",(0,i.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Sutton, R. S., & Barto, A. G. (2018). ",(0,i.jsx)(e.em,{children:"Reinforcement Learning: An Introduction"})," (2nd ed.). MIT Press. (Chapter 3: The Reinforcement Learning Problem, and Chapter 6: Temporal-Difference Learning for the concept of return maximization)."]}),"\n",(0,i.jsxs)(e.li,{children:["Todorov, E., Erez, T., & Tassa, Y. (2012). MuJoCo: A physics engine for model-based control. ",(0,i.jsx)(e.em,{children:"IEEE/RSJ International Conference on Intelligent Robots and Systems (IROS)"}),", 5026-5033. (For details on MuJoCo state data structures)."]}),"\n",(0,i.jsxs)(e.li,{children:["Ruiz, C., et al. (2018). IMU-based humanoid robot balance control with disturbances. ",(0,i.jsx)(e.em,{children:"International Conference on Robotics and Automation (ICRA)"}),", 5605-5610. (For real-world IMU challenges in robotics)."]}),"\n"]})]})}function x(s={}){const{wrapper:e}={...(0,t.R)(),...s.components};return e?(0,i.jsx)(e,{...s,children:(0,i.jsx)(d,{...s})}):d(s)}}}]);